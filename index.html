
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ventilator Tank Calculator</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
  .container { max-width: 500px; margin: auto; padding: 20px; background: #fff; min-height: 100vh; box-sizing: border-box; }
  h1 { font-size: 1.8em; margin-bottom: 10px; text-align: center; }
  label { display: block; margin-top: 15px; font-weight: bold; }
  input[type="number"] { width: 100%; padding: 12px; font-size: 1em; margin-top: 5px; box-sizing: border-box; }
  button { margin-top: 20px; padding: 15px; width: 48%; font-size: 1.1em; border: none; border-radius: 8px; cursor: pointer; }
  button:first-of-type { background: #007BFF; color: #fff; }
  button:last-of-type { background: #6c757d; color: #fff; margin-left: 4%; }
  #results { margin-top: 25px; background: #e9ecef; padding: 15px; border-radius: 8px; display: none; font-size: 1em; }
  #debug { margin-top: 20px; background: #222; color: #0f0; padding: 15px; font-family: monospace; white-space: pre-wrap; max-height: 200px; overflow-y: auto; border-radius: 8px; font-size: 0.9em; }
  #customTanksSelection { margin-top: 20px; display: none; background: #e0e7ff; padding: 15px; border-radius: 8px; }
  #customTanksSelection h3 { margin-top: 0; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { text-align: center; padding: 6px; }
  td input[type="radio"] { transform: scale(1.2); cursor: pointer; }
  #combinedLitresDisplay { margin-top: 10px; font-weight: bold; }
  #volumeCheckMessage { margin-top: 10px; font-weight: bold; }
</style>
</head>
<body>
<div class="container">
  <h1>Ventilator Tank Calculator</h1>

  <label>Minute Ventilation (L/min)</label>
  <input type="number" id="minuteVentilation" placeholder="Enter value" step="0.01" />

  <label>Leak (L/min)</label>
  <input type="number" id="leak" placeholder="Enter value" step="0.01" />

  <label>Bias Flow (L/min)</label>
  <input type="number" id="biasFlow" placeholder="Enter value" step="0.01" />

  <label>Hours to Ventilate</label>
  <input type="number" id="hours" placeholder="Enter value" step="0.01" />

  <label>FiO₂ (%)</label>
  <input type="number" id="fio2" placeholder="Enter FiO₂ (20.9 - 100)" step="0.1" min="20.9" max="100" />

  <div style="display:flex; justify-content: space-between;">
    <button onclick="calculate()">Calculate</button>
    <button onclick="resetForm()">Reset</button>
  </div>

  <div id="results">
    <h2>Results</h2>
    <p><strong>Litres per Minute:</strong> <span id="litresPerMinute"></span> L/min</p>
    <p><strong>Total Litres:</strong> <span id="totalLitres"></span> L</p>
    <p><strong>Recommended Tank:</strong> <span id="tankSize"></span></p>
    <p><strong>Extra Litres Left in Tank:</strong> <span id="extraLitres"></span> L</p>
    <p id="alertMessage" style="color:red; font-weight:bold;"></p>
    <p id="twoTanksOption" style="font-weight:bold;"></p>
  </div>

  <div id="customTanksSelection">
    <h3>Select Tanks (up to 3)</h3>
    <table id="tankTable">
      <thead>
        <tr>
          <th>Tank</th>
          <th>Option 1</th>
          <th>Option 2</th>
          <th>Option 3</th>
        </tr>
      </thead>
      <tbody>
        <!-- Tank rows will be generated -->
      </tbody>
    </table>
    <div id="combinedLitresDisplay">
      Total Combined Litres: <span id="combinedLitres">0</span> L
    </div>
    <div id="volumeCheckMessage"></div>
  </div>

  <div id="debug">Debug Output:</div>
</div>

<script>
  function logDebug(message) {
    const debugBox = document.getElementById("debug");
    debugBox.textContent += message + "\\n";
    console.log(message);
  }

  const tankSizes = [
    { name: "D", value: 425 },
    { name: "E", value: 680 },
    { name: "M60", value: 1738 },
    { name: "M/MM/M122", value: 3455 },
    { name: "H/K", value: 7080 },
  ];

  let selectedTanks = [];
  let totalLitresRequired = 0;

  function generateTankRows() {
    const tbody = document.querySelector("#tankTable tbody");
    tbody.innerHTML = "";
    tankSizes.forEach((tank, index) => {
      const row = document.createElement("tr");
      const nameCell = document.createElement("td");
      nameCell.innerText = `${tank.name} (${tank.value} L)`;
      row.appendChild(nameCell);

      for (let i = 0; i < 3; i++) {
        const cell = document.createElement("td");
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = `tank_${index}_${i}`; // unique per cell
        radio.dataset.tank = tank.name;
        radio.dataset.value = tank.value;
        radio.addEventListener("change", onTankSelect);
        cell.appendChild(radio);
        row.appendChild(cell);
      }
      tbody.appendChild(row);
    });
  }

  function onTankSelect(e) {
    const radio = e.target;
    const tankName = radio.dataset.tank;
    const tankValue = parseFloat(radio.dataset.value);

    if (radio.checked) {
      if (selectedTanks.length >= 3) {
        alert("You can select up to 3 tanks only.");
        radio.checked = false;
        return;
      }
      selectedTanks.push({ name: tankName, value: tankValue });
    } else {
      selectedTanks = selectedTanks.filter(
        (t, i) => !(t.name === tankName && t.value === tankValue && i === selectedTanks.length - 1)
      );
    }

    updateCombinedVolume();
  }

  function updateCombinedVolume() {
    const combinedLitresSpan = document.getElementById("combinedLitres");
    const messageDiv = document.getElementById("volumeCheckMessage");
    const combinedVolume = selectedTanks.reduce((sum, t) => sum + t.value, 0);
    combinedLitresSpan.innerText = combinedVolume.toFixed(2);

    if (totalLitresRequired > 0) {
      if (combinedVolume >= totalLitresRequired) {
        messageDiv.style.color = "green";
        messageDiv.innerText = "Selected tanks CAN supply the required volume.";
      } else {
        messageDiv.style.color = "red";
        messageDiv.innerText = "Selected tanks CANNOT supply the required volume.";
      }
    } else {
      messageDiv.innerText = "";
    }
  }

  window.calculate = function () {
    const minuteVentilation = parseFloat(document.getElementById("minuteVentilation").value) || 0;
    const



